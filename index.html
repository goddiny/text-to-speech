<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>–¢–µ—Å—Ç SpeechRecognition</title>
<style>
    body { display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; font-family: Arial; margin:0; }
    button { padding: 15px 30px; font-size: 20px; margin-bottom: 20px; }
    textarea { width: 90%; max-width: 500px; height: 200px; font-size: 16px; }
</style>
</head>
<body>
<button id="startBtn">üé§ –ù–∞—á–∞—Ç—å –∑–∞–ø–∏—Å—å</button>
<textarea id="output" readonly placeholder="–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å"></textarea>

<script>
const startBtn = document.getElementById('startBtn');
const output = document.getElementById('output');

const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
if (!SpeechRecognition) {
    output.value = "–í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç Web Speech API.";
} else {
    const recognition = new SpeechRecognition();
    recognition.lang = 'ru-RU';
    recognition.interimResults = true;
    recognition.continuous = true;

    let recording = false;

    recognition.onresult = (event) => {
        let interim = '';
        let finalText = '';
        for (let i = event.resultIndex; i < event.results.length; ++i) {
            if (event.results[i].isFinal) {
                finalText += event.results[i][0].transcript + ' ';
            } else {
                interim += event.results[i][0].transcript;
            }
        }
        output.value = finalText + '|' + interim; // final | –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–π
        console.log('Final:', finalText, 'Interim:', interim);
    };

    recognition.onerror = (event) => {
        output.value = '–û—à–∏–±–∫–∞: ' + event.error;
        console.log('–û—à–∏–±–∫–∞:', event);
    };

    startBtn.onclick = async () => {
        if (!recording) {
            try {
                await navigator.mediaDevices.getUserMedia({ audio: true });
                recognition.start();
                recording = true;
                startBtn.textContent = '‚ñ† –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–ø–∏—Å—å';
            } catch (err) {
                output.value = '–ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ –º–∏–∫—Ä–æ—Ñ–æ–Ω—É';
            }
        } else {
            recognition.stop();
            recording = false;
            startBtn.textContent = 'üé§ –ù–∞—á–∞—Ç—å –∑–∞–ø–∏—Å—å';
        }
    };
}
</script>
</body>
</html>